{
	"openapi": "3.1.0",
	"info": {
		"title": "nri_scheduler",
    "version": "0.1.0",
    "description": "my outstanding trpg scheduler"
	},
	"paths": {
		"/api/registration": {
			"post": {
				"tags": [
					"profile"
				],
				"summary": "Регистрация нового пользователя",
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/RegistrationDto"
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "Результат выполнения запроса",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AppResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/signin": {
			"post": {
				"tags": [
					"profile"
				],
				"summary": "Авторизация",
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/SignInDto"
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "Результат выполнения запроса",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AppResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/logout": {
			"post": {
				"tags": [
					"profile"
				],
				"summary": "Окончание сессии",
				"responses": {
					"200": {
						"description": "Результат выполнения запроса",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AppResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/events": {
			"get": {
				"tags": [
					"events"
				],
				"summary": "Получение списка событий",
				"parameters": [
					{
						"name": "date_from",
						"in": "query",
						"description": "Начало периода для поиска событий",
						"required": true,
						"schema": {
							"type": "string",
							"format": "date-time"
						}
					},
					{
						"name": "date_to",
						"in": "query",
						"description": "Конец периода для поиска событий",
						"required": true,
						"schema": {
							"type": "string",
							"format": "date-time"
						}
					},
					{
						"name": "master",
						"in": "query",
						"description": "Идентификатор мастера, проводящего игру",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "location",
						"in": "query",
						"description": "Идентификатор локации, на которой проводится игра",
						"required": false,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					},
					{
						"name": "applied",
						"in": "query",
						"description": "Признак, подавал ли пользоватьель заявку на игру",
						"required": false,
						"schema": {
							"type": "boolean"
						}
					},
					{
						"name": "not_rejected",
						"in": "query",
						"description": "Признак, что заявку пользователя не отклонили",
						"required": false,
						"schema": {
							"type": "boolean"
						}
					},
					{
						"name": "imamaster",
						"in": "query",
						"description": "Признак, что пользователь является мастером на игре",
						"required": false,
						"schema": {
							"type": "boolean"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Результат выполнения запроса",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AppResponseWithEventsList"
								}
							}
						}
					}
				},
				"security": [
					{},
					{
						"cookieAuth": []
					}
				]
			}
		},
		"/api/events/{id}": {
			"get": {
				"tags": [
					"events"
				],
				"summary": "Получение события по идентификатору",
				"parameters": [
					{
						"name": "id",
						"in": "path",
						"description": "Идентификатор события",
						"required": true,
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Результат выполнения запроса",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AppResponseWithEvent"
								}
							}
						}
					}
				},
				"security": [
					{},
					{
						"cookieAuth": []
					}
				]
			}
		}
	},
	"components": {
		"schemas": {
			"EScenarioStatus": {
				"type": "integer",
				"enum": [0, 1, 2, 3, 4],
				"description": "RPC статус результата",
				"x-enum-descriptions": [
					"Успех",
					"Ошибка авторизации",
					"Ошибка бизнес логики",
					"Ошибка приложения",
					"Сессия истекла"
				],
				"x-enum-varnames": [
					"SCENARIO_SUCCESS",
					"UNAUTHORIZED",
					"SCENARIO_FAIL",
					"SYSTEM_ERROR",
					"SESSION_EXPIRED"
				]
			},
			"RegistrationDto": {
				"type": "object",
				"description": "Данные для регистрации пользователя",
				"required": [
					"nickname",
					"email",
					"password"
				],
				"properties": {
					"nickname": {
						"type": "string",
						"description": "Имя пользователя"
					},
					"email": {
						"type": "string",
						"format": "email",
						"description": "Электронная почта пользователя"
					},
					"password": {
						"type": "string",
						"format": "password",
						"description": "Пароль пользователя"
					},
					"timezone_offset": {
						"type": "integer",
						"nullable": true,
						"description": "Смещение временной зоны пользователя"
					}
				}
			},
			"SignInDto": {
				"type": "object",
				"description": "Данные для авторизации",
				"required": [
					"email",
					"password"
				],
				"properties": {
					"email": {
						"type": "string",
						"format": "email",
						"description": "Электронная почта пользователя"
					},
					"password": {
						"type": "string",
						"format": "password",
						"description": "Пароль пользователя"
					}
				}
			},
			"Event": {
				"type": "object",
				"description": "Событие (игра)",
				"properties": {
					"id": {
						"type": "string",
						"format": "uuid",
						"description": "Идентификатор события"
					},
					"company": {
						"type": "string",
						"description": "Название кампании"
					},
					"company_id": {
						"type": "string",
						"format": "uuid",
						"description": "Идентификатор кампании"
					},
					"master": {
						"type": "string",
						"description": "Имя мастера"
					},
					"master_id": {
						"type": "string",
						"format": "uuid",
						"description": "Идентификатор мастера"
					},
					"location": {
						"type": "string",
						"description": "Место проведения"
					},
					"location_id": {
						"type": "string",
						"format": "uuid",
						"description": "Идентификатор места проведения"
					},
					"date": {
						"type": "string",
						"format": "date-time",
						"description": "Дата и время проведения игры в формате UTC"
					},
					"players": {
						"type": "array",
						"items": {
							"type": "string"
						},
						"description": "Список имён игроков, подавших заявку"
					},
					"max_slots": {
						"type": "integer",
						"nullable": true,
						"description": "Максимальное количество игроков"
					},
					"plan_duration": {
						"type": "integer",
						"nullable": true,
						"description": "Планируемая продолжительность игры в часах"
					},
					"you_applied": {
						"type": "boolean",
						"description": "Подал ли уже пользователь заявку на данную игру"
					},
					"your_approval": {
						"type": "boolean",
						"nullable": true,
						"description": "Одобрил ли мастер заявку пользователя на участие"
					}
				}
			},
			"AppResponse": {
				"type": "object",
				"description": "Ответ приложения без дополнительной информации",
				"properties": {
					"status": {
						"$ref": "#/components/schemas/EScenarioStatus"
					},
					"result": {
						"type": "string",
						"description": "Текстовое описание результата"
					},
					"payload": {
						"type": "null",
						"description": "Дополнительные данные"
					}
				}
			},
			"AppResponseWithEventsList": {
				"type": "object",
				"description": "Ответ приложения без дополнительной информации",
				"properties": {
					"status": {
						"$ref": "#/components/schemas/EScenarioStatus"
					},
					"result": {
						"type": "string",
						"description": "Текстовое описание результата"
					},
					"payload": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/Event"
						}
					}
				}
			},
			"AppResponseWithEvent": {
				"type": "object",
				"description": "Ответ приложения без дополнительной информации",
				"required": [
					"status",
					"result",
					"payload"
				],
				"properties": {
					"status": {
						"$ref": "#/components/schemas/EScenarioStatus"
					},
					"result": {
						"type": "string",
						"description": "Текстовое описание результата"
					},
					"payload": {
						"$ref": "#/components/schemas/Event"
					}
				}
			}
		},
		"securitySchemes": {
			"cookieAuth": {
				"type": "apiKey",
				"in": "cookie",
				"name": "authorization"
			}
		}
	},
	"tags": [
		{
			"name": "profile",
			"description": "Работа с персональными данными пользователя"
		},
		{
			"name": "events",
			"description": "Просмотр предстоящих событий (игр)"
		}
	]
}
